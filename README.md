# Умная копилка

- [Описание проекта](#описание-проекта)
- [Принципиальная схема](#принципиальная-схема)
- [Устранение помех](#устранение-помех)
- [Печатная плата](#печатная-плата)
- [Готовое устройство](#готовое-устройство-на-печатной-плате)
- [Демонстрация работы устройства](#демонстрация-работы-устройства)
- [Начальная версия проводная сборка](#начальная-версия-проводная-сборка)

## Описание проекта
Проект сделан в августе 2017 года, в 2026 году переведен на печатную плату 

В основе алгоритма лежит принцип оптического прерывания.
При прохождении монеты через луч инфракрасного светодиода она заслоняет часть излучения, направленного на фототранзитор. Наименьший диаметр (1 рубль) даёт минимальное перекрытие светового потока (минимальное падение напряжения на фототранзисторе), а наибольший (5 рублей) — максимальное (максимальное падение напряжения на фототранзисторе). Система осуществляет запись сигнала с привязкой ко времени пролета монеты, получая зависимость падения напряжения на фототранзисторе от времени и сравнивает его с записанными в памяти калибровочными эталонами для каждого номинала. 
В процессе работы система запоминает количество монет каждого номинала и может выводить итоговый отчет: количество монет каждого номинала
  
## Принципиальная схема
Зарядный модуль для аккумулятора 18650 реализован по классической схеме с использованием 3-х микросхем: TP4056 — заряжает аккумулятор стабильным током около 1 А до достижения 4.2 В; DW01A — контроллер защиты отслеживает напряжение на аккумуляторе и ток через силовые ключи, обеспечивая защиту от переразряда ниже 2.4 В, перезаряда выше 4.3 В и перегрузки по току (КЗ); FS8205A - сдвоенный N-канальный MOSFET, который разрывает цепь между аккумулятором и схемой по сигналу от DW01A (при переразряде, перезаряде или КЗ), переходя в режим блокировки и требует подключения зарядного устройства для выхода их этого режима. В процессе зарядка аккумулятора горит красный светодиод, по окончании процесса загорается зеленый.

Для питания Arduino и дисплея используется повышающий DC-DC преобразователь на микросхеме MC34063. Входное напряжение: 3-4.2 В (аккумулятор 18650), выходное: 5 В. В первоначальной схеме, где Arduino питалась напрямую от аккумулятора, происходило преждевременное отключение микроконтроллера при снижении напряжения до 3.9 В. При этом повышающий преобразователь и дисплей включались отдельно по сигналу от Arduino через MOSFET, что не решало проблему нижнего порога питания. Во итоговой схеме Arduino стала запитываться от непрерывно работающего повышающего преобразователя. Это позволило стабилизировать напряжение на входе микроконтроллера, благодаря чему система сохраняет полную работоспособность даже при снижении напряжения на аккумуляторе до 3 В. Дисплей также управляется отдельно по сигналу от Arduino через транзисторный ключ. 

Однако данное решение привело к увеличению энергопотребления: в режиме покоя система потребляет 4 мА, а в активном режиме — 124 мА. Такой ток покоя является значительным и аккумулятора хватает примерно на 20 дней.

Для дальнейшего снижения энергопотребления, особенно в состоянии покоя, необходима замена преобразователя на более эффективную модель, например MT3608, у которого намного меньше ток покоя

<img width="1572" height="1206" alt="схема" src="https://github.com/user-attachments/assets/9d9b0b8b-0bfe-4618-b3e1-bd621f862e28" />

## Устранение помех
Повышающий импульсный преобразователь на MC34063 создавал значительные помехи из-за чего Arduino Nano работала некорректно, система сама засчитывала отсутвующие монеты. В начальной версии с навесным монтажом для подавления помех достаточно было установить конденсатор на 470 мкФ. Однако после перехода на печатную плату этого оказалось мало, и для надёжного подавления помех был добавлен LC-фильтр с частотой среза 2,3 кГц. Кроме того, преобразователь был максимально удалён от Arduino Nano и аналоговой части схемы, включающей фототранзистор, а аналоговая земля была отделена от силовой. В результате устройство стало работать стабильно, а уровень пульсаций снизился в 7,8 раза — со 110 мВ до 14 мВ. Сравнение осциллограмм до и после применения фильтра приведено на рисунках ниже

![3](https://github.com/user-attachments/assets/dce3d189-ba2f-46eb-b301-966bd0b2f0eb)

![2](https://github.com/user-attachments/assets/e60fa110-1b18-41c7-b6f8-fce23d79c2c7)

## Печатная плата
<img width="1347" height="1183" alt="top" src="https://github.com/user-attachments/assets/b246ec95-a63a-44dc-9f9e-05360a5b189f" />

<img width="1341" height="1178" alt="bottom" src="https://github.com/user-attachments/assets/4d0040cf-17e4-4a49-b0c1-1325dcd3dcb2" />


## Готовое устройство на печатной плате
Для компактности печатной платы и гибкости размещения компонентов в различных местах устройства — таких как аккумулятор, фототранзистор, ИК-светодиод, кнопка включения и дисплей — их подключение к печатной плате было реализовано с помощью гнездовых разъёмов

Плата изготовлена вручную с помощью фоторезистивного метода. Для изоляции токопроводящих дорожек на плату нанесена паяльная маска, сформированная методом УФ-экспонирования через фотошаблон.

![IMG_7616](https://github.com/user-attachments/assets/88f3a9ad-155d-4de6-8403-eab665cecf64)
![IMG_7614](https://github.com/user-attachments/assets/79594854-b17b-4d22-b8c2-b8bacfff977c)

## Демонстрация работы устройства

https://github.com/user-attachments/assets/6564e9d2-360d-4a35-9b7b-7dd74c4bb71a

Видео в хорошем качестве: https://vk.ru/video339693071_456240566?list=ln-Yu4aHB95lXeS058iF1

## Начальная  версия проводная сборка
![photo_2025-12-08_00-28-32](https://github.com/user-attachments/assets/0a75ebcf-ec1d-4ffe-a683-f30dddcaac35)
